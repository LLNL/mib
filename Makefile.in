#*****************************************************************************\
#*  $Id: Makefile,v 1.9 2005/11/30 20:24:57 auselton Exp $
#*****************************************************************************
#*  Copyright (C) 2001-2002 The Regents of the University of California.
#*  Produced at Lawrence Livermore National Laboratory (cf, DISCLAIMER).
#*  Written by Andrew Uselton <uselton2@llnl.gov>
#*  UCRL-CODE-2006-xxx.
#*  
#*  This file is part of Mib, an MPI-based parallel I/O benchamrk
#*  For details, see <http://www.llnl.gov/linux/mib/>.
#*  
#*  Mib is free software; you can redistribute it and/or modify it under
#*  the terms of the GNU General Public License as published by the Free
#*  Software Foundation; either version 2 of the License, or (at your option)
#*  any later version.
#*  
#*  Mib is distributed in the hope that it will be useful, but WITHOUT 
#*  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or 
#*  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License 
#*  for more details.
#*  
#*  You should have received a copy of the GNU General Public License along
#*  with Mib; if not, write to the Free Software Foundation, Inc.,
#*  59 Temple Place, Suite 330, Boston, MA  02111-1307  USA.
#*****************************************************************************/

PROJECT=mib
CLUSTER=%CLUSTER%
VERSION=%VERSION%
SHELL=   /bin/sh
MAKE=    /usr/bin/make
CC = %CC%
INSTALL= /usr/bin/install -c
mkinstalldirs=	 $(SHELL) $(top_srcdir)/aux/mkinstalldirs

CCFLAGS = -g -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64
LDFLAGS =
LIBDIRS = 
LIBS = 
INCDIR = 
DEBUG = # Put 'DEBUG="-DDEBUG_CODE=1"' on the command line if you want 
	# debugging, or you can put it here if you really want to be sure
	# and always have the debugging on.  N.B. I don't think it even
	# works right now.

top_srcdir	=	.
prefix		=	/usr
exec_prefix	=	${prefix}
bindir		=	${exec_prefix}/bin
sbindir		= 	${exec_prefix}/sbin
mandir		=	$(prefix)/man
etcdir		=	/etc
packagedir	=	${etcdir}/${PROJECT}
scriptdir       =       /var/lustredata/scripts
parmsdir        =       /var/lustredata/mib-parms

BIN=/g/g0/auselton/$(CLUSTER)

HEADERS = miberr.h mpi_wrap.h sys_wrap.h options.h mib_timer.h
SOURCES = mib.c mpi_wrap.c sys_wrap.c miberr.c options.c mib_timer.c
OBJECTS = $(SOURCES:.c=.o)

all: mib 
	$(MAKE) -C tools

mib: $(OBJECTS) $(HEADERS)
	$(CC) $(OBJECTS) $(DEBUG) -o $@ $(LIBDIRS) $(LIBS)

install: all
	$(mkinstalldirs) 			$(DESTDIR)$(bindir)
	$(INSTALL) mib				$(DESTDIR)$(bindir)/
	$(mkinstalldirs)			$(DESTDIR)$(mandir)/man1
	$(INSTALL) -m 644 mib.1			$(DESTDIR)$(mandir)/man1/
	$(mkinstalldirs)			$(DESTDIR)$(parmsdir)
	$(INSTALL) mib-parms/options		$(DESTDIR)$(parmsdir)/
	$(mkinstalldirs)			$(DESTDIR)$(scriptdir)
	$(INSTALL) tools/composite.pl		$(DESTDIR)$(scriptdir)/
	$(INSTALL) tools/diff.pl		$(DESTDIR)$(scriptdir)/
	$(INSTALL) tools/file-layout.sh		$(DESTDIR)$(scriptdir)/
	$(INSTALL) tools/hullo-lustre.sh	$(DESTDIR)$(scriptdir)/
	$(INSTALL) tools/lfind-dist1.pl		$(DESTDIR)$(scriptdir)/
	$(INSTALL) tools/lfind-dist2.pl		$(DESTDIR)$(scriptdir)/
	$(INSTALL) tools/lfind-dist3.pl		$(DESTDIR)$(scriptdir)/
	$(INSTALL) tools/lfinding.sh		$(DESTDIR)$(scriptdir)/
	$(INSTALL) tools/lwatch.pl		$(DESTDIR)$(scriptdir)/
	$(INSTALL) tools/mest.sh		$(DESTDIR)$(scriptdir)/
	$(INSTALL) tools/mib.sh			$(DESTDIR)$(scriptdir)/
	$(INSTALL) tools/profile.pl		$(DESTDIR)$(scriptdir)/
	$(INSTALL) tools/rm-files.sh		$(DESTDIR)$(scriptdir)/
	$(INSTALL) tools/sum.pl			$(DESTDIR)$(scriptdir)/
	$(INSTALL) tools/viewcalls.pl		$(DESTDIR)$(scriptdir)/

.c.o:
	$(CC) $(CCFLAGS) $(DEBUG) -c $<  $(INCDIR)

clean: 
	$(MAKE) -C tools clean
	rm -f *.o mib *~

distclean: clean
	rm Makefile version.h mib.spec
